<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IntelliSummarize - NLP Summarizer & AI Bot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .chat-container::-webkit-scrollbar { width: 6px; }
        .chat-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .chat-container::-webkit-scrollbar-track { background: #f1f5f9; }
        .dot-flashing { position: relative; width: 8px; height: 8px; border-radius: 5px; background-color: #475569; color: #475569; animation: dotFlashing 1s infinite linear alternate; animation-delay: .5s; }
        .dot-flashing::before, .dot-flashing::after { content: ''; display: inline-block; position: absolute; top: 0; }
        .dot-flashing::before { left: -12px; width: 8px; height: 8px; border-radius: 5px; background-color: #475569; color: #475569; animation: dotFlashing 1s infinite alternate; animation-delay: 0s; }
        .dot-flashing::after { left: 12px; width: 8px; height: 8px; border-radius: 5px; background-color: #475569; color: #475569; animation: dotFlashing 1s infinite alternate; animation-delay: 1s; }
        @keyframes dotFlashing { 0% { background-color: #475569; } 50%, 100% { background-color: #94a3b8; } }
        .prose { color: #334155; } .prose h3 { font-size: 1.1em; margin-bottom: 0.5em; } .prose ul { padding-left: 1.25rem; list-style-type: disc; } .prose li { margin-bottom: 0.5rem; } .prose strong { color: #1e293b; }
    </style>
</head>
<body class="antialiased text-slate-700">
    <div class="min-h-screen bg-slate-50 p-4 lg:p-8">
        <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden border border-slate-200/80">
            <header class="bg-gradient-to-r from-slate-700 to-slate-800 text-white p-5 sm:p-6 flex items-center justify-between">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold tracking-tight">IntelliSummarize</h1>
                    <p class="text-slate-300 text-sm md:text-base">NLP Summarizer & AI Bot</p>
                </div>
                <div class="w-12 h-12 bg-white/10 rounded-lg flex items-center justify-center ring-1 ring-white/20">
                     <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
                </div>
            </header>

            <main class="grid grid-cols-1 lg:grid-cols-2 gap-6 p-5 sm:p-8">
                <!-- Left Column -->
                <div class="flex flex-col space-y-6">
                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                        <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center">
                            <i data-lucide="file-text" class="w-5 h-5 mr-2.5 text-slate-500"></i>
                            1. Input Your Chat Log
                        </h2>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
                            <div class="relative" id="custom-select-container">
                               <input type="hidden" id="chat-format-selector" value="generic">
                               <button id="format-select-button" type="button" class="w-full h-full bg-slate-50 border border-slate-300 rounded-md py-2.5 px-3.5 text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 transition flex items-center justify-between text-left">
                                   <span id="selected-format-text" class="truncate">Generic (e.g., User1: Hello)</span>
                                   <i data-lucide="chevron-down" class="w-4 h-4 text-slate-500 transition-transform flex-shrink-0 ml-2"></i>
                               </button>
                               <div id="format-select-options" class="hidden absolute z-10 mt-1 w-full bg-white rounded-md shadow-lg border border-slate-200/80 p-1">
                                   <a href="#" class="text-slate-700 block px-3 py-1.5 text-sm rounded-md hover:bg-slate-100" data-value="generic">Generic (e.g., User1: Hello)</a>
                                   <a href="#" class="text-slate-700 block px-3 py-1.5 text-sm rounded-md hover:bg-slate-100" data-value="whatsapp">WhatsApp (e.g., [10/22/25, 11:20 AM] John: Hi)</a>
                                   <a href="#" class="text-slate-700 block px-3 py-1.5 text-sm rounded-md hover:bg-slate-100" data-value="slack">Slack / Discord (e.g., username [11:20 AM])</a>
                               </div>
                           </div>
                           <div>
                               <label for="screenshot-input" class="w-full h-full bg-slate-50 border border-slate-300 rounded-md py-2.5 px-3.5 text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 transition flex items-center justify-center text-left cursor-pointer hover:bg-slate-100 truncate">
                                   <i data-lucide="image-plus" class="w-4 h-4 text-slate-500 flex-shrink-0 mr-2"></i>
                                   <span id="attach-screenshot-text" class="truncate">Attach Screenshot</span>
                               </label>
                               <input type="file" id="screenshot-input" class="hidden" accept="image/*">
                           </div>
                       </div>

                        <div id="image-preview-container" class="hidden relative w-32 h-32 mb-3 rounded-md overflow-hidden border border-slate-200 shadow-sm">
                            <img id="image-preview" class="w-full h-full object-cover" src="">
                            <button id="remove-image-btn" class="absolute top-1 right-1 bg-black/60 text-white rounded-full p-0.5 hover:bg-black/80 transition-colors">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>

                        <textarea id="chat-input" class="w-full h-64 p-3.5 bg-slate-50 border border-slate-300 rounded-md resize-y focus:outline-none focus:ring-2 focus:ring-slate-500 transition" placeholder="Paste your chat conversation here..."></textarea>
                        
                        <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <button id="summarize-nlp-btn" class="w-full bg-slate-200 text-slate-600 font-semibold py-3 px-4 rounded-lg hover:bg-slate-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-400 transition-all flex items-center justify-center disabled:bg-slate-100 disabled:cursor-not-allowed">
                                <i data-lucide="cpu" class="w-5 h-5 mr-2"></i>
                                Summarize with NLP
                            </button>
                             <button id="summarize-gemini-btn" class="w-full bg-slate-700 text-white font-semibold py-3 px-4 rounded-lg hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-600 transition-all transform hover:scale-[1.02] flex items-center justify-center disabled:bg-slate-500 disabled:cursor-not-allowed disabled:scale-100">
                                <i data-lucide="zap" class="w-5 h-5 mr-2"></i>
                                Summarize with Gemini
                            </button>
                        </div>
                    </div>
                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm flex-grow">
                        <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center">
                           <i data-lucide="book-marked" class="w-5 h-5 mr-2.5 text-slate-500"></i>
                           2. Generated Summary
                        </h2>
                        <div class="w-full min-h-[16rem] h-full p-3.5 bg-slate-50 border border-slate-300 rounded-md overflow-y-auto prose max-w-none">
                            <div id="summary-placeholder" class="text-slate-400 h-full flex flex-col items-center justify-center text-center">
                                <i data-lucide="clipboard-list" class="w-12 h-12 mb-3 text-slate-300"></i>
                                <p class="font-medium">Your summary will appear here.</p>
                            </div>
                            <div id="summary-loader" class="hidden items-center justify-center h-full">
                               <div class="text-center">
                                    <div class="dot-flashing mx-auto"></div>
                                    <p class="mt-4 text-sm text-slate-500">Running analysis...</p>
                                </div>
                            </div>
                            <div id="summary-output" class="hidden"></div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: AI Chatbot -->
                <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm flex flex-col h-[85vh] max-h-[860px]">
                    <h2 class="text-lg font-semibold text-slate-800 mb-1 flex items-center">
                        <i data-lucide="message-circle" class="w-5 h-5 mr-2.5 text-slate-500"></i>
                        3. Ask the AI Bot (Powered by Gemini)
                    </h2>
                    <p class="text-sm text-slate-500 mb-4">Ask questions about the conversation after generating a summary.</p>
                    <div id="chatbot-container" class="flex-grow bg-slate-50 border border-slate-200 rounded-lg overflow-y-auto p-4 space-y-4 chat-container">
                        <div class="flex items-start gap-3">
                            <div class="w-9 h-9 rounded-full bg-slate-700 flex items-center justify-center flex-shrink-0 ring-4 ring-white">
                               <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                            </div>
                            <div class="flex flex-col w-full max-w-[320px] leading-1.5 p-3.5 border-slate-200 bg-slate-200 rounded-e-xl rounded-es-xl">
                                <p class="text-sm font-normal text-slate-800">Hello! I'm a Gemini-powered bot. Once you've summarized a chat, you can ask me questions about it.</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center">
                        <input type="text" id="chatbot-input" class="flex-grow p-3.5 border border-slate-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-slate-500 disabled:bg-slate-200 transition" placeholder="Ask a follow-up question..." disabled>
                        <button id="chatbot-send-btn" class="bg-slate-700 text-white p-3.5 rounded-r-lg hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-slate-600 disabled:bg-slate-500 disabled:cursor-not-allowed flex items-center justify-center w-16 h-[54px] transition-colors">
                           <i data-lucide="send-horizontal" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();

        const chatInput = document.getElementById('chat-input');
        const summarizeNlpBtn = document.getElementById('summarize-nlp-btn');
        const summarizeGeminiBtn = document.getElementById('summarize-gemini-btn');
        const summaryPlaceholder = document.getElementById('summary-placeholder');
        const summaryLoader = document.getElementById('summary-loader');
        const summaryOutput = document.getElementById('summary-output');
        const chatbotContainer = document.getElementById('chatbot-container');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSendBtn = document.getElementById('chatbot-send-btn');
        let originalChatContext = "";
        let currentImageData = null;

        // --- Screenshot Upload Logic ---
        const screenshotInput = document.getElementById('screenshot-input');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.getElementById('image-preview');
        const removeImageBtn = document.getElementById('remove-image-btn');
        const attachScreenshotText = document.getElementById('attach-screenshot-text');

        screenshotInput.addEventListener('change', () => {
            const file = screenshotInput.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    currentImageData = e.target.result.split(',')[1];
                    imagePreview.src = e.target.result;
                    imagePreviewContainer.classList.remove('hidden');
                    attachScreenshotText.textContent = file.name;
                };
                reader.readAsDataURL(file);
            }
        });

        removeImageBtn.addEventListener('click', () => {
            currentImageData = null;
            screenshotInput.value = '';
            imagePreviewContainer.classList.add('hidden');
            imagePreview.src = '';
            attachScreenshotText.textContent = 'Attach Screenshot';
            lucide.createIcons();
        });

        // --- Custom Select Dropdown Logic ---
        const customSelectContainer = document.getElementById('custom-select-container');
        const formatSelectButton = document.getElementById('format-select-button');
        const formatSelectOptions = document.getElementById('format-select-options');
        const selectedFormatText = document.getElementById('selected-format-text');
        const chatFormatSelector = document.getElementById('chat-format-selector');

        formatSelectButton.addEventListener('click', () => {
            formatSelectOptions.classList.toggle('hidden');
            const chevronIcon = formatSelectButton.querySelector('svg');
            if(chevronIcon) chevronIcon.classList.toggle('rotate-180');
        });

        formatSelectOptions.addEventListener('click', (e) => {
            e.preventDefault();
            const target = e.target.closest('a');
            if (target) {
                const value = target.getAttribute('data-value');
                const text = target.textContent;
                chatFormatSelector.value = value;
                selectedFormatText.textContent = text;
                formatSelectOptions.classList.add('hidden');
                const chevronIcon = formatSelectButton.querySelector('svg');
                if(chevronIcon) chevronIcon.classList.remove('rotate-180');
            }
        });
        
        window.addEventListener('click', (e) => {
            if (!customSelectContainer.contains(e.target)) {
                formatSelectOptions.classList.add('hidden');
                const chevronIcon = formatSelectButton.querySelector('svg');
                if(chevronIcon) chevronIcon.classList.remove('rotate-180');
            }
        });

        // --- NLP Summarizer (TF-IDF Algorithm) ---
        const performNlpSummarization = (text, topN = 3) => {
            const sentences = text.split('\n').filter(s => s.trim().length > 15);
            if (sentences.length < 3) return "The conversation is too short to generate a meaningful summary. Please provide more text.";
            const stopWords = new Set(["a", "about", "above", "after", "again", "against", "all", "am", "an", "and", "any", "are", "aren't", "as", "at", "be", "because", "been", "before", "being", "below", "between", "both", "but", "by", "can't", "cannot", "could", "couldn't", "did", "didn't", "do", "does", "doesn't", "doing", "don't", "down", "during", "each", "few", "for", "from", "further", "had", "hadn't", "has", "hasn't", "have", "haven't", "having", "he", "he'd", "he'll", "he's", "her", "here", "here's", "hers", "herself", "him", "himself", "his", "how", "how's", "i", "i'd", "i'll", "i'm", "i've", "if", "in", "into", "is", "isn't", "it", "it's", "its", "itself", "let's", "me", "more", "most", "mustn't", "my", "myself", "no", "nor", "not", "of", "off", "on", "once", "only", "or", "other", "ought", "our", "ours", "ourselves", "out", "over", "own", "same", "shan't", "she", "she'd", "she'll", "she's", "should", "shouldn't", "so", "some", "such", "than", "that", "that's", "the", "their", "theirs", "them", "themselves", "then", "there", "there's", "these", "they", "they'd", "they'll", "they're", "they've", "this", "those", "through", "to", "too", "under", "until", "up", "very", "was", "wasn't", "we", "we'd", "we'll", "we're", "we've", "were", "weren't", "what", "what's", "when", "when's", "where", "where's", "which", "while", "who", "who's", "whom", "why", "why's", "with", "won't", "would", "wouldn't", "you", "you'd", "you'll", "you're", "you've", "your", "yours", "yourself", "yourselves"]);
            const tokenize = (sentence) => { const message = sentence.replace(/^[^:]+:\s*/, ''); return message.toLowerCase().split(/\s+/).filter(word => word.length > 0 && word.match(/^[a-zA-Z]+$/) && !stopWords.has(word)); }
            const tokenizedSentences = sentences.map(tokenize);
            const calculateTf = (tokens) => { const tf = {}; tokens.forEach(token => { tf[token] = (tf[token] || 0) + 1; }); for (const token in tf) { tf[token] /= tokens.length; } return tf; };
            const idf = {}; const allTokens = new Set([].concat(...tokenizedSentences));
            allTokens.forEach(token => { const docsWithToken = tokenizedSentences.filter(tokens => tokens.includes(token)).length; idf[token] = Math.log(tokenizedSentences.length / (docsWithToken + 1)); });
            const sentenceScores = tokenizedSentences.map((tokens, index) => { let score = 0; const sentenceTf = calculateTf(tokens); tokens.forEach(token => { score += (sentenceTf[token] * idf[token]) || 0; }); const positionalBonus = 1.0 / (index + 1); const finalScore = score + (positionalBonus * 0.25); return { score: finalScore, index }; });
            sentenceScores.sort((a, b) => b.score - a.score);
            const jaccardSimilarity = (tokensA, tokensB) => { const setA = new Set(tokensA); const setB = new Set(tokensB); const intersection = new Set([...setA].filter(x => setB.has(x))); const union = new Set([...setA, ...setB]); return intersection.size / union.size; };
            const summaryIndices = []; const similarityThreshold = 0.3;
            for (const scoredSentence of sentenceScores) { if (summaryIndices.length >= topN) break; let isSimilar = false; for (const summaryIndex of summaryIndices) { const similarity = jaccardSimilarity(tokenizedSentences[scoredSentence.index], tokenizedSentences[summaryIndex]); if (similarity > similarityThreshold) { isSimilar = true; break; } } if (!isSimilar) { summaryIndices.push(scoredSentence.index); } }
            summaryIndices.sort((a, b) => a - b);
            return `<h3>Key Sentences (TF-IDF, Positional Weighting & Redundancy Check)</h3><ul>${summaryIndices.map(index => `<li>${sentences[index]}</li>`).join('')}</ul>`;
        };
        
        // --- Generic Gemini API Caller ---
        const callGeminiEndpoint = async (endpoint, prompt, imageData = null) => {
            const functionUrl = `/.netlify/functions/${endpoint}`;
            try {
                const response = await fetch(functionUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, imageData })
                });

                const responseBody = await response.text();

                if (!response.ok) {
                    throw new Error(`Function error! status: ${response.status}, body: ${responseBody}`);
                }
                
                const result = JSON.parse(responseBody);
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    return candidate.content.parts[0].text;
                } else {
                    console.error("Invalid response from function:", result);
                    throw new Error("Invalid response structure from the function.");
                }
            } catch (error) {
                console.error(`API call to ${endpoint} failed:`, error);
                return `Error: Could not get a response from the AI. Please check the Netlify function logs for more details.`;
            }
        };

        const setButtonsLoading = (isLoading, source) => {
            summarizeNlpBtn.disabled = isLoading;
            summarizeGeminiBtn.disabled = isLoading;
            const loadingHtml = `<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div><span class="ml-2">Analyzing...</span>`;
            const nlpLoadingHtml = `<div class="w-5 h-5 border-2 border-slate-400 border-t-transparent rounded-full animate-spin"></div><span class="ml-2">Analyzing...</span>`;

            if (isLoading) {
                 if (source === 'gemini') {
                    summarizeGeminiBtn.innerHTML = loadingHtml;
                 } else {
                    summarizeNlpBtn.innerHTML = nlpLoadingHtml;
                 }
            } else {
                summarizeNlpBtn.innerHTML = `<i data-lucide="cpu" class="w-5 h-5 mr-2"></i> Summarize with NLP`;
                summarizeGeminiBtn.innerHTML = `<i data-lucide="zap" class="w-5 h-5 mr-2"></i> Summarize with Gemini`;
                lucide.createIcons();
            }
        };
        
        const displaySummary = (summaryHtml) => {
            summaryOutput.innerHTML = summaryHtml.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n\s?\* (.*?)/g, '<ul><li>$1</li></ul>').replace(/<\/ul><ul>/g, '');
            summaryLoader.classList.add('hidden');
            summaryLoader.classList.remove('flex');
            summaryOutput.classList.remove('hidden');
        };

        summarizeNlpBtn.addEventListener('click', () => {
            const chatText = chatInput.value.trim();
            if (!chatText) {
                alert('Please paste a chat conversation to generate an NLP summary.');
                return;
            }
            setButtonsLoading(true, 'nlp');

            summaryPlaceholder.classList.add('hidden');
            summaryOutput.classList.add('hidden');
            summaryLoader.classList.remove('hidden');
            summaryLoader.classList.add('flex');

            setTimeout(() => { 
                const summary = performNlpSummarization(chatText);
                displaySummary(summary);
                originalChatContext = chatText;
                chatbotInput.disabled = false;
                chatbotSendBtn.disabled = false;
                chatbotInput.placeholder = "Ask about the conversation...";
                setButtonsLoading(false);
            }, 500);
        });
        
        summarizeGeminiBtn.addEventListener('click', async () => {
            const chatText = chatInput.value.trim();
            if (!chatText && !currentImageData) {
                alert('Please paste a chat conversation or attach a screenshot to summarize.');
                return;
            }
            setButtonsLoading(true, 'gemini');
            summaryPlaceholder.classList.add('hidden');
            summaryOutput.classList.add('hidden');
            summaryLoader.classList.remove('hidden');
            summaryLoader.classList.add('flex');
            
            const chatFormat = selectedFormatText.textContent;
            let summarizationPrompt = `
                You are an expert at analyzing and summarizing conversations.
                Summarize the following chat conversation, which is in the format of "${chatFormat}".
                Your summary should be clear, concise, and structured. Use Markdown for formatting.
                Include the following sections with bolded titles (e.g., **Key Topics Discussed**):
                - Key Topics Discussed: A bulleted list of the main subjects.
                - Main Outcomes & Decisions: A bulleted list of any conclusions, decisions, or action items.
                - Overall Sentiment: A brief description of the mood of the conversation.

                Here is the conversation text:
                ---
                ${chatText}
                ---
            `;
            if (currentImageData) {
                summarizationPrompt += `\n\nThe user has also attached a screenshot. Use both the text and the image to create the most accurate summary possible.`;
            }

            const summary = await callGeminiEndpoint('summarize', summarizationPrompt, currentImageData);
            displaySummary(summary);
            originalChatContext = chatText;
            chatbotInput.disabled = false;
            chatbotSendBtn.disabled = false;
            chatbotInput.placeholder = "Ask about the conversation...";
            setButtonsLoading(false);
        });

        const handleChatbotSend = async () => {
            const userQuery = chatbotInput.value.trim();
            if (!userQuery) return;
            appendMessage(userQuery, 'user');
            chatbotInput.value = '';
            chatbotInput.disabled = true;
            chatbotSendBtn.disabled = true;

            const typingIndicator = createTypingIndicator();
            chatbotContainer.appendChild(typingIndicator);
            chatbotContainer.scrollTop = chatbotContainer.scrollHeight;

            const chatbotPrompt = `You are a helpful AI assistant tasked with answering questions about a specific chat conversation. Use ONLY the provided conversation context (and attached screenshot, if any) to answer the user's question. Do not make up information. If the answer is not in the context, say "The answer to that question isn't available in the provided materials."\n\nCONVERSATION CONTEXT:\n---\n${originalChatContext}\n---\n\nUSER'S QUESTION: "${userQuery}"`;
            
            const botResponse = await callGeminiEndpoint('chatbot', chatbotPrompt, currentImageData);
            
            typingIndicator.remove();
            appendMessage(botResponse, 'bot');
            chatbotInput.disabled = false;
            chatbotSendBtn.disabled = false;
            chatbotInput.focus();
        };

        const appendMessage = (text, sender) => {
            const messageWrapper = document.createElement('div');
            let messageHtml = '';
            if (sender === 'user') {
                 messageHtml = `<div class="flex items-start gap-3 justify-end"><div class="flex flex-col w-full max-w-[320px] leading-1.5 p-3.5 border-slate-200 bg-slate-700 text-white rounded-s-xl rounded-ee-xl"><p class="text-sm font-normal">${text}</p></div><div class="w-9 h-9 rounded-full bg-slate-200 flex items-center justify-center flex-shrink-0 ring-4 ring-white"><i data-lucide="user" class="w-5 h-5 text-slate-600"></i></div></div>`;
            } else {
                messageHtml = `<div class="flex items-start gap-3"><div class="w-9 h-9 rounded-full bg-slate-700 flex items-center justify-center flex-shrink-0 ring-4 ring-white"><i data-lucide="bot" class="w-5 h-5 text-white"></i></div><div class="flex flex-col w-full max-w-[320px] leading-1.5 p-3.5 border-slate-200 bg-slate-200 rounded-e-xl rounded-es-xl"><p class="text-sm font-normal text-slate-800">${text}</p></div></div>`;
            }
            messageWrapper.innerHTML = messageHtml;
            chatbotContainer.appendChild(messageWrapper);
            chatbotContainer.scrollTop = chatbotContainer.scrollHeight;
            lucide.createIcons();
        };
        
        const createTypingIndicator = () => {
            const typingWrapper = document.createElement('div');
            typingWrapper.id = 'typing-indicator';
            typingWrapper.innerHTML = `<div class="flex items-start gap-3"><div class="w-9 h-9 rounded-full bg-slate-700 flex items-center justify-center flex-shrink-0 ring-4 ring-white"><i data-lucide="bot" class="w-5 h-5 text-white"></i></div><div class="flex items-center space-x-2 p-3.5 bg-slate-200 rounded-e-xl rounded-es-xl"><div class="dot-flashing"></div></div></div>`;
            lucide.createIcons();
            return typingWrapper;
        };

        chatbotSendBtn.addEventListener('click', handleChatbotSend);
        chatbotInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey && !chatbotInput.disabled) {
                e.preventDefault();
                handleChatbotSend();
            }
        });
    });
    </script>
</body>
</html>

